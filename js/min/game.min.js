
window.buoy=function(s,e){"use strict";var n=e.documentElement.classList,t=function(s,e){return n?s.classList.contains(e):new RegExp("(^|\\s)"+e+"(\\s|$)").test(s.className)},a=function(s,e){t(s,e)||(n?s.classList.add(e):s.className+=(s.className?" ":"")+e)},c=function(s,e){t(s,e)&&(n?s.classList.remove(e):s.className=s.className.replace(new RegExp("(^|\\s)*"+e+"(\\s|$)*","g"),""))},i=function(s,e){n?s.classList.toggle(e):t(s,e)?c(s,e):a(s,e)},l=function(s){for(var e=[],n=s.parentNode.firstChild;n;n=n.nextSibling)1==n.nodeType&&n!=s&&e.push(n);return e};return{toggleClass:i,removeClass:c,addClass:a,hasClass:t,getSiblings:l}}(window,document);
document.addEventListener("DOMContentLoaded",function(){function e(){var e=document.querySelector(".overlay");buoy.addClass(e,"active")}var n;[].forEach.call(document.querySelectorAll(".home button"),function(o){o.addEventListener("click",function(){function o(){a.destroy(),buoy.removeClass(i.parentNode,"active"),buoy.removeClass(r,"active"),i.innerHTML=""}var t,a,i=document.querySelector(".overlay .modal"),r=document.querySelector(".game");if(buoy.hasClass(this,"create")){buoy.addClass(r,"active"),e();var c=Math.random().toString(36).substr(2,5);i.innerHTML+="<h4>Your room id is...</h4>",i.innerHTML+="<h2>"+c+"</h2>",i.innerHTML+="<p>Give this code to your friend to join/watch!</p>",i.innerHTML+='<p class="light"><i class="fa fa-spinner"></i> Waiting for someone to join...',i.innerHTML+='<button class="cancel">Cancel</button>',a=new Peer("dwo"+c,{key:"fbpvikd79qpsnhfr",debug:3}),a.on("connection",function(e){t=e,e.on("open",function(){buoy.removeClass(i.parentNode,"active"),onMessage(e),playInit(e,n)})}),document.querySelector(".overlay .cancel").addEventListener("click",function(){o()})}else buoy.hasClass(this,"join")&&validDeck()?(buoy.addClass(r,"active"),e(),i.innerHTML+="<h4>Enter Room ID to join:</h4>",i.innerHTML+='<input type="text">',i.innerHTML+='<button class="cancel">Cancel</button>',a=new Peer({key:"fbpvikd79qpsnhfr",debug:3}),document.querySelector(".overlay input").addEventListener("keypress",function(e){e||(e=window.event);var o=e.keyCode||e.which;if("13"==o){var r=this.value.replace(/\s+/g,"");return t=a.connect("dwo"+r,{reliable:!0}),t.on("open",function(){buoy.removeClass(i.parentNode,"active"),onMessage(t),playInit(t,n)}),!1}}),document.querySelector(".overlay .cancel").addEventListener("click",function(){o()})):buoy.hasClass(this,"build")})}),validDeck=function(){return!0},onMessage=function(e){e.on("data",function(e){console.log(e),"testCard"===e[0]&&testCard(e[1])})}});
function playInit(n,a){function t(n){for(var a,t,r=n.length;0!==r;)t=Math.floor(Math.random()*r),r-=1,a=n[r],n[r]=n[t],n[t]=a;return n}function r(t){t="undefined"!=typeof t?t:1;for(var r=0;t>r;r++){var e=a.pop();n.send(["testCard",e])}}var e={},a=[{type:"infantry",id:0,hash:0},{type:"recon",id:0,hash:0},{type:"apc",id:0,hash:0}];a=t(a);for(var o=0;o<a.length;o++){var d=Math.random().toString(36).substr(2,9);a[o].id+="_"+d;var h=md5(a[o]);a[o].hash=h,e[h]=1,o===a.length-1&&(console.log("Sending hashed deck"),n.send(["odeck",e]),r(3))}}